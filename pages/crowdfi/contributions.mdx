# Contributing funds

import { Callout } from 'nextra-theme-docs'
import { Tab, Tabs } from 'nextra-theme-docs'

Contributions are allowed as long as the following conditions are met

1. The campaign has started
2. The campaign has not ended
3. The campaign max goal is not met

#### Contributing ETH

Contributions are made to ETH denominated contracts by invoking the `contributeEth()` function with msg.value set the amount of wei.

<Tabs items={['Solidity', 'Cast', 'Viem']}>
  <Tab>
  ```solidity
    ICrowdFinancingV1(address).contributeEth{ value: 1 ether }();
  ```
  </Tab>
  <Tab>
  ```
    TODO
  ```
  </Tab>
  <Tab>
  ```ts
  await walletClient.writeContract({
    address: CAMPAIGN_ADDR,
    abi: crowdfiAbi,
    functionName: 'contributeEth',
    value: parseEther('1')
  });
  ```
  </Tab>
</Tabs>

#### Contributing ERC20 Tokens

Contributions are made to ERC20 denominated contracts by invoking the `contributeERC20(amount)` function. This first requires
that the campaign contract has an allowance greater than or equal to the amount specified in the call.

If the contracts allowance for the ERC20 token is less than the amount specified, then the transaction will revert.

<Tabs items={['Solidity', 'Cast', 'Viem']}>
  <Tab>
  ```solidity
    ICrowdFinancingV1 contract = ICrowdFinancingV1(address);
    require(IERC20(contract.erc20Address()).approve(campaignAddress, 1e6), 'ERC20: Approval Failed');
    contract.contributeERC20(1e6);
  ```
  </Tab>
  <Tab>
  ```
    TODO
  ```
  </Tab>
  <Tab>
  ```ts
  await walletClient.writeContract({
    address: TOKEN_ADDRESS,
    abi: erc20Abi,
    functionName: 'approve',
    args: [CAMPAIGN_ADDR, 10000n]
  })

  await walletClient.writeContract({
    address: CAMPAIGN_ADDR,
    abi: crowdfiAbi,
    functionName: 'contributeEth',
    args: [10000n]
  })
  ```
  </Tab>
</Tabs>

#### Preflight Checks

Before contributing funds to the contract, it's best to check if contributions are allowed and the min and max contribution amounts
for a given account.

<Callout type="warning" emoji="⚠️">
  If an account attempts to contribute a value outside the range, the transaction will revert
</Callout>

<Tabs items={['Solidity', 'Cast', 'Viem']}>
  <Tab>
  ```solidity
    // TODO
  ```
  </Tab>
  <Tab>
  ```
    TODO
  ```
  </Tab>
  <Tab>
  ```ts
  // TODO
  async function isContributionValid(contract: Contract, account: string, amount: bigint) : Promise<boolean> {
    const allowed = await contract.isContributionAllowed();
    const { 0: low, 1: high } = await contract.contributionRangeFor(account);
    return allowed && amount >= low && amount <= high;
  }
  ```
  </Tab>
</Tabs>
